global:
  edition: ee
  ingress:
    enabled: false
    configureCertmanager: false
  hosts:
    domain: "code.dsop.io"
    gitlab:
      name: "code.dsop.io"

#   registry:
#     bucket: gitlab-registry-storage

  kubectl:
    image:
      repository: registry.dsop.io/platform-one/apps/gitlab/kubectl-ib
      tag: 13.2.0-ib

  certificates:
    image:
      repository: registry.dsop.io/platform-one/apps/gitlab/alpine-certificates
      tag: 20171114-r3
  busybox:
    image:
      repository: registry.dsop.io/platform-one/apps/gitlab/busybox
      tag: latest

  # Use external postgresql
  psql:
    host: db.admin.dsop.io
    port: 5432
    username: rdsuser
    database: gitlab
    password:
      secret: db-credentials
      key: PGPASSWORD

  # Uncomment for External Minio (S3)
  # minio:
  #   enabled: false
  # appConfig:
  #   lfs:
  #     bucket: $ARGOCD_APP_SOURCE_TARGET_REVISION-t-rex-bootstrap-p1-k8s-gitlab-storage
  #     connection:
  #       secret: s3-creds
  #       key: rails
  #   artifacts:
  #     bucket: $ARGOCD_APP_SOURCE_TARGET_REVISION-t-rex-bootstrap-p1-k8s-gitlab-storage
  #     connection:
  #       secret: s3-creds
  #       key: rails
  #   uploads:
  #     bucket: $ARGOCD_APP_SOURCE_TARGET_REVISION-t-rex-bootstrap-p1-k8s-gitlab-storage
  #     connection:
  #       secret: s3-creds
  #       key: rails
  #   packages:
  #     bucket: $ARGOCD_APP_SOURCE_TARGET_REVISION-t-rex-bootstrap-p1-k8s-gitlab-storage
  #     connection:
  #       secret: s3-creds
  #       key: rails
  #   backups:
  #     bucket: $ARGOCD_APP_SOURCE_TARGET_REVISION-t-rex-bootstrap-p1-k8s-gitlab-storage
  #     connection:
  #       secret: s3-creds
  #       key: rails

  grafana:
    enabled: false

gitlab:
  gitlab-exporter:
    image:
      repository: registry.dsop.io/platform-one/apps/gitlab/gitlab-exporter-ib
      tag: 13.2.0-ib
  gitlab-shell:
    image:
      repository: registry.dsop.io/platform-one/apps/gitlab/gitlab-shell-ib
      tag: 13.2.0-ib
  migrations:
    image:
      repository: registry.dsop.io/platform-one/apps/gitlab/gitlab-task-runner-ib
      tag: 13.2.0-ib
  sidekiq:
    image:
      repository: registry.dsop.io/platform-one/apps/gitlab/gitlab-sidekiq-ib
      tag: 13.0.4-ib
  webservice:
    helmTests:
      enabled: false
    ingress:
      enabled: false
    webservice:
      registry:
        enabled: false
    image:
      repository: registry.dsop.io/platform-one/apps/gitlab/gitlab-webservice-ib
      tag: 13.1.1-ib
    workhorse:
      image: registry.dsop.io/platform-one/apps/gitlab/gitlab-workhorse-ib
      tag: 13.2.0-ib
  gitaly:
    persistence:
      size: 50Gi
    image:
      repository: registry.dsop.io/platform-one/apps/gitlab/gitaly-ib
      tag: 13.0.4-ib
  task-runner:
  # Use external postgresql - Note must be the same as global value
  # Helm chart for 4.2.0 used a different path for variable so had to duplicate
    psql:
      host: db.admin.dsop.io
      port: 5432
      username: rdsuser
      database: gitlab
      password:
        secret: db-credentials
        key: PGPASSWORD
    persistence:
      enabled: true
      accessMode: ReadWriteOnce
      size: 10Gi
    image:
      repository: registry.dsop.io/platform-one/apps/gitlab/gitlab-task-runner-ib
      tag: 13.2.0-ib

# TODO: Use external postgresql
postgresql:
  install: false

registry:
  enabled: true
  host: "registry.dsop.io"
  ingress:
    enabled: false
  image:
    repository: registry.dsop.io/platform-one/apps/gitlab/gitlab-container-registry-ib
    tag: 13.2.0-ib

#  storage:
#    secret: s3-creds
#    key: registry

# Use istio instead
nginx-ingress:
  enabled: false

# lol I wish
certmanager:
  install: false

# Install gitlab-runner seperately
gitlab-runner:
  install: false

shared-secrets:
  selfsign:
    image:
      repository: registry.dsop.io/platform-one/apps/gitlab/cfssl-self-sign
      tag: 1.2

minio:
  image: "registry.dsop.io/platform-one/apps/gitlab/minio-ib"
  imageTag: "RELEASE.2020-07-02T00-15-09Z-ib"
  minioMc:
    image: registry.dsop.io/platform-one/apps/gitlab/minio/mc
    tag: "RELEASE.2018-07-13T00-53-22Z"

redis:
  master:
    command: "redis-server"
  slave:
    command: "redis-server"
  image:
    registry: registry.dsop.io/platform-one/apps/gitlab
    repository: bitnami/redis-ib
    tag: 5.0.9-ib
  metrics:
    image:
      registry: registry.dsop.io/platform-one/apps/gitlab
      repository: bitnami/redis-exporter-ib
      tag: 1.5.3-ib

prometheus:
  configmapReload:
    image:
      repository: registry.dsop.io/platform-one/apps/gitlab/jimmidyson/configmap-reload
      tag: v0.3.0
  server:
    image:
      repository: registry.dsop.io/platform-one/apps/gitlab/prometheus/prometheus-ib
      tag: 2.20.0-ib

